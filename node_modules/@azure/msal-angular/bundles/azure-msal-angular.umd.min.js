!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("msal"),require("@angular/router"),require("@angular/common"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","rxjs","rxjs/operators","msal","@angular/router","@angular/common","@angular/common/http"],t):t(((e=e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.msal,e.ng.router,e.ng.common,e.ng.common.http)}(this,(function(e,t,r,o,n,a,i,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var u=function(){return(u=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function l(e,t,r,o){var n,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function p(e,t){return function(r,o){t(r,o,e)}}function f(e,t,r,o){return new(r||(r=Promise))((function(n,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((o=o.apply(e,t||[])).next())}))}function h(e,t){var r,o,n,a,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var g=function(){function e(){this._msalSubject=new r.BehaviorSubject(1),this.msalItem$=this._msalSubject.asObservable()}return e.prototype.broadcast=function(e,t){this._msalSubject.next({type:e,payload:t})},e.prototype.getMSALSubject=function(){return this._msalSubject},e.prototype.getMSALItem=function(){return this.msalItem$},e.prototype.subscribe=function(e,t){return this.msalItem$.pipe(o.filter((function(t){return t.type===e})),o.map((function(e){return e.payload}))).subscribe(t)},e=l([t.Injectable()],e)}(),d=function(){function e(e,t,r){this._error="",this._errorDesc="",this._scopes="",this._error=e,t&&(this._errorDesc=t),r&&(this._scopes=r)}return Object.defineProperty(e.prototype,"error",{get:function(){return this._error},set:function(e){this._error=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDesc",{get:function(){return this._errorDesc},set:function(e){this._errorDesc=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scopes",{get:function(){return this._scopes},set:function(e){this._scopes=e},enumerable:!0,configurable:!0}),e}(),m=new t.InjectionToken("MSAL_CONFIG"),y=new t.InjectionToken("MSAL_CONFIG_ANGULAR"),v=function(e){return u(u({},e),{framework:u(u({},e.framework),{isAngular:!0})})},b=function(e){function r(t,r,o,n){var a=e.call(this,v(t))||this;return a.msalConfig=t,a.msalAngularConfig=r,a.router=o,a.broadcastService=n,window.addEventListener("msal:popUpHashChanged",(function(e){a.getLogger().verbose("popUpHashChanged ")})),window.addEventListener("msal:popUpClosed",(function(e){var t=e.detail.split("|"),r=new d(t[0],t[1]);a.getLoginInProgress()?(n.broadcast("msal:loginFailure",r),a.setloginInProgress(!1)):a.getAcquireTokenInProgress()&&(n.broadcast("msal:acquireTokenFailure",r),a.setAcquireTokenInProgress(!1))})),a.router.events.subscribe((function(e){for(var t=0;t<o.config.length;t++)o.config[t].canActivate||a.msalAngularConfig.unprotectedResources&&(a.isEmpty(o.config[t].path)||a.isUnprotectedResource(o.config[t].path)||a.msalAngularConfig.unprotectedResources.push(o.config[t].path))})),a}return function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(r,e),r.prototype.isUnprotectedResource=function(e){var t=this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources,r=this.msalAngularConfig.unprotectedResources||[];return(t&&t.length?t:r).some((function(t){return e.indexOf(t)>-1}))},r.prototype.isEmpty=function(e){return void 0===e||!e||0===e.length},r.prototype.loginPopup=function(t){var r=this;return e.prototype.loginPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:loginSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:loginFailure",e),r.getLogger().error("Error during login:\n"+e.errorMessage),e}))},r.prototype.ssoSilent=function(t){var r=this;return e.prototype.ssoSilent.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:ssoSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:ssoFailure",e),r.getLogger().error("Error during login:\n"+e.errorMessage),e}))},r.prototype.acquireTokenSilent=function(t){var r=this;return e.prototype.acquireTokenSilent.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes: "+t.scopes+" "+e),e}))},r.prototype.acquireTokenPopup=function(t){var r=this;return e.prototype.acquireTokenPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes : "+t.scopes+" "+e),e}))},r.prototype.handleRedirectCallback=function(t,r){var o=this;e.prototype.handleRedirectCallback.call(this,(function(e,n){e?(o.getAccount()?o.broadcastService.broadcast("msal:acquireTokenFailure",e):o.broadcastService.broadcast("msal:loginFailure",e),r?r(e,n.accountState):t(e,n)):n&&("id_token"===n.tokenType?o.broadcastService.broadcast("msal:loginSuccess",n):o.broadcastService.broadcast("msal:acquireTokenSuccess",n),r?t(n):t(null,n))}))},r.prototype.clearCacheForScope=function(t){return e.prototype.clearCacheForScope.call(this,t)},r.prototype.getScopesForEndpoint=function(t){if(this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources&&this.getLogger().info("msalConfig.framework.unprotectedResources is deprecated, use msalAngularConfig.unprotectedResources"),this.isUnprotectedResource(t))return null;var r=this.msalConfig.framework&&this.msalConfig.framework.protectedResourceMap;r&&this.getLogger().info("msalConfig.framework.protectedResourceMap is deprecated, use msalAngularConfig.protectedResourceMap");var o=r&&r.size?r:new Map(this.msalAngularConfig.protectedResourceMap),a=Array.from(o.keys()).find((function(e){return t.indexOf(e)>-1}));return a?o.get(a):t.indexOf("http://")>-1||t.indexOf("https://")>-1?n.UrlUtils.getHostFromUri(t)===n.UrlUtils.getHostFromUri(e.prototype.getRedirectUri.call(this))?new Array(this.msalConfig.auth.clientId):null:new Array(this.msalConfig.auth.clientId)},r.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[m]}]},{type:void 0,decorators:[{type:t.Inject,args:[y]}]},{type:a.Router},{type:g}]},r=l([t.Injectable(),p(0,t.Inject(m)),p(1,t.Inject(y))],r)}(n.UserAgentApplication),S=function(){function e(e,t,r,o,n,a,i,c){this.msalConfig=e,this.msalAngularConfig=t,this.authService=r,this.router=o,this.activatedRoute=n,this.location=a,this.platformLocation=i,this.broadcastService=c}return e.prototype.getDestinationUrl=function(e){var t=document.getElementsByTagName("base"),r=this.location.normalize(t.length?t[0].href:window.location.origin),o=this.location.prepareExternalUrl(e);return o.startsWith("#")?r+"/"+o:""+r+e},e.prototype.loginInteractively=function(e){return f(this,void 0,void 0,(function(){var t;return h(this,(function(r){return this.msalAngularConfig.popUp?[2,this.authService.loginPopup({scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters}).then((function(){return!0})).catch((function(){return!1}))]:(t=this.getDestinationUrl(e),this.authService.loginRedirect({redirectStartPage:t,scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters}),[2])}))}))},e.prototype.canActivate=function(e,t){var r=this;return this.authService.getLogger().verbose("location change event from old url to new url"),n.UrlUtils.urlContainsHash(window.location.hash)&&n.WindowUtils.isInIframe()?(this.authService.getLogger().warning("redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),!1):this.authService.getAccount()?this.authService.acquireTokenSilent({scopes:[this.msalConfig.auth.clientId]}).then((function(){return!0})).catch((function(e){if(n.InteractionRequiredAuthError.isInteractionRequiredError(e.errorCode))return r.authService.getLogger().info("Interaction required error in MSAL Guard, prompting for interaction."),r.loginInteractively(t.url);throw r.authService.getLogger().error("Non-interaction error in MSAL Guard: "+e.errorMessage),e})):this.loginInteractively(t.url)},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[m]}]},{type:void 0,decorators:[{type:t.Inject,args:[y]}]},{type:b},{type:a.Router},{type:a.ActivatedRoute},{type:i.Location},{type:i.PlatformLocation},{type:g}]},e=l([t.Injectable(),p(0,t.Inject(m)),p(1,t.Inject(y))],e)}(),w=function(){function e(e,t){this.auth=e,this.broadcastService=t}return e.prototype.intercept=function(e,t){var a,i=this,s=this.auth.getScopesForEndpoint(e.url);return this.auth.getLogger().verbose("Url: "+e.url+" maps to scopes: "+s),s?r.from(this.auth.acquireTokenSilent({scopes:s}).then((function(t){var r="Bearer "+(a=t.tokenType===n.ServerHashParamKeys.ID_TOKEN?t.idToken.rawIdToken:t.accessToken);return e.clone({setHeaders:{Authorization:r}})}))).pipe(o.mergeMap((function(e){return t.handle(e)})),o.tap((function(e){}),(function(e){e instanceof c.HttpErrorResponse&&401===e.status&&(i.auth.clearCacheForScope(a),i.broadcastService.broadcast("msal:notAuthorized",e.message))}))):t.handle(e)},e.ctorParameters=function(){return[{type:b},{type:g}]},e=l([t.Injectable()],e)}(),A={consentScopes:[],popUp:!1,extraQueryParameters:{},unprotectedResources:[],protectedResourceMap:[]},k=function(){function e(){}var r;return r=e,e.forRoot=function(e,t){return void 0===t&&(t=A),{ngModule:r,providers:[{provide:m,useValue:e},{provide:y,useValue:t},b]}},e=r=l([t.NgModule({imports:[i.CommonModule],declarations:[],providers:[S,g]})],e)}();e.BroadcastService=g,e.MSAL_CONFIG=m,e.MSAL_CONFIG_ANGULAR=y,e.MsalGuard=S,e.MsalInterceptor=w,e.MsalModule=k,e.MsalService=b,e.ɵa=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map